<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="../scripts/style.css" />
<script src="../scripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="../scripts/clipboard.min.js"></script>
<title>Google Earth Engine for Ecology and Conservation</title>
</head>

<body>

<div id="wrap">
<div id="header">
<h1>GOOGLE EARTH ENGINE APPLICATIONS</h1>
<h1>IN ECOLOGY AND CONSERVATION</h1>
</div>

<div id="content">
<h2>GOOGLE EARTH ENGINE FOR ECOLOGY AND CONSERVATION</h2>
<p><strong>Practical 5: Fire frequency in the Kruger National Park, South Africa</strong>
<br>by Sandra MacFadyen @ <a href="https://www0.sun.ac.za/biomath/">https://www0.sun.ac.za/biomath</a>
<br>Access the practical script <a href="https://code.earthengine.google.com/a320787ea8a9056e8b4fcba139e012b7">here</a>.
<br>Also please download the following shapefile delineating <a href="https://drive.google.com/file/d/1Acs8PLINsehpsZvDj-g9BnAkLuVYKVv3/view?usp=sharing">regional boundaries</a> in Kruger.
<br><br>
<strong>Learning Objectives</strong>
<br>By the end of this practical you should be able to:
<br>
<ol>
<li>Access terrain model data from SRTM</li>
<li>Access monthly burn scar data</li>
<li>Generate a hillshade using SRTM data</li>
<li>Explore long-term patterns of fire frequency</li>
<li>Build an animation and output for use in, for example, PowerPoint presentations</li>
</ol>
<hr>
<p><strong>Introduction</strong>
<br>Fire is an important driver of landscape pattern, as different fire regimes directly affect biomass production, composition and structure of vegetation. 
Indirectly, and together with other landscape features like geology, rainfall and topography, fire also influences animal distribution patterns. 
In savanna systems, interactions between herbivory, fire frequency, fire intensity and season can alter tree:grass ratios and system states. 
For example, in the Kruger National Park (Kruger) landscapes that are burnt frequently by high intensity fires generally have less woody cover than those 
burnt less frequently, at low intensities. Fire regime can also influence vegetation composition, where fire adapted species may dominate in frequently burnt areas, 
while those areas less frequently burnt may provide important refugia for more fire sensitive species (<a href="https://onlinelibrary.wiley.com/doi/full/10.1111/j.1600-0587.2012.07555.x" target="_blank">Smit et al. 2013</a>). 
Fire is therefore an important component for biodiversity conservation planning but how do we find information about fire frequencies, 
intensities and seasons for our areas of interest if we haven’t monitored it directly? 
 GEE has a number of different <a href="https://developers.google.com/earth-engine/datasets/tags/fire" target="_blank">datasets tagged &quot;fire&quot;</a>. 
We'll just be looking at one in this practical but I encourage you to explore the others in your own time. Let’s get started……</p>
<hr>
<p><strong>Data import</strong>
<br>In addition to datasets available on Google Earth Engine, in this practical we will learn how to import your own data (like shapefiles or raster grids)
into your workspace from your local hard-drive by uploading them as new assets (Fig. 1).</p>

<pre><p><code class="javascript" id="target1">var dem = ee.Image("CGIAR/SRTM90_V4");
var FireCCI = ee.ImageCollection('ESA/CCI/FireCCI/5_1');</code><button class="btn" id="copy-button" data-clipboard-target="#target1">Copy</button>
<script>new ClipboardJS('.btn');</script></pre>
  
<p>The first dataset, <a href="https://developers.google.com/earth-engine/datasets/catalog/USGS_SRTMGL1_003">SRTM30</a>, is a 30m Digital Elevation Model (DEM) 
from the Shuttle Radar Topography Mission (SRTM). The second, <a href="https://developers.google.com/earth-engine/datasets/catalog/ESA_CCI_FireCCI_5_1">FireCCI51</a>, 
is a Fire_cci Burned Area pixel product version 5.1 from MODIS. 
Figure 1 below, describes how to import the boundary shapefile for the Kruger National Park (Kruger) from files stored locally on your hard-drive. 
The process is similar to import image files (e.g. GeoTIFF or TFRecords), which we'll go through in class.
Download and save the required files from <a href="https://drive.google.com/file/d/1omD5vPk4LMQSnC2BHJCg6GlnmpzBsFQG/view?usp=sharing">here</a>.</p>
<p><img src="img/5_img2.png" alt="">
<br><strong>Figure 1:</strong> Process to upload a shapefile into GEE as a new assest imported into the script as a FeatureColection</p>
<hr>
<p><strong>Filtering data</strong>
<br>First define your variables for the temporal and spatial windows of interest. 
We will use these variables to filter our data before processing.</p>

<pre><p><code class="javascript" id="target2">// Set your start and end dates to filter by
var startDate = ee.Date.fromYMD(2001,1,1);
var endDate = ee.Date.fromYMD(2018,12,31);
var years = ee.List(fire.aggregate_array('year')).distinct().sort();

// Convert your imported "Table" asset to a geometry
// You'll need it later for clipping ImageCollections
var zones_geo = zones.geometry();

// Clip the DEM to Kruger
var srtm = dem.clipToCollection(zones);

// Filter the Burn Scars by date and clip using a function and set band properties
var fire = FireCCI
    .select(['BurnDate','ConfidenceLevel'])
    .filterDate(startDate, endDate)
    .map(function(img) { // Use function to add year as property to each image
      return img
           .clip(zones_geo)
           .set('year', ee.Image(img).date().get('year'))
       	   .set('yrmnth',ee.Date.parse('YYYY_MM_DD', (img.get('system:index')))
		   .format('YYYY_MM'));
    });
print('Check fire', fire); // Use print() to check your results</code><button class="btn" id="copy-button" data-clipboard-target="#target2">Copy</button>
<script>new ClipboardJS('.btn');</script></pre>
<hr>
<p><strong>Processing</strong>
<br>Now build a function to remove all burn scars from the fire dataset that have a confidence interval of less than 50%.</p> 
 
<pre><p><code class="javascript" id="target3">// Define a function to remove all fires <50% confidence interval
var confMask = function(img) {
  var conf = img.select('ConfidenceLevel');
  var level = conf.gt(50);
  return img.updateMask(level).select('BurnDate'); //return only 'BurnDate' band};</code><button class="btn" id="copy-button" data-clipboard-target="#target3">Copy</button>
<script>new ClipboardJS('.btn');</script></pre>
  
<p>Run the function and summarise the burn scars by the day-of-year (doy) most frequently burnt, followed by the the frequency areas are burnt 
in Kruger annually from 2001 until 2018.</p>
<pre><p><code class="javascript" id="target4">// Most frequently burnt DOY
var fireDOY_list = years.map(function(year) {
  return fire
    .filterMetadata('year', 'equals', year) // Filter image collection by year
    .map(confMask) // Apply confidence mask >50%
    .reduce(ee.Reducer.mode()).rename('fire_doy') 
 // Reduce image collection by most common DOY
    .set('year', year) // Set composite year as an image property
    .set('system:time_start', ee.Date.fromYMD(year, 1, 1));
});
var doyFires = ee.ImageCollection.fromImages(fireDOY_list); 
// Convert the image List back to an ImageCollection

// Frequency of days burnt
var fireCnt_list = years.map(function(year) {
  return fire
    .filterMetadata('year', 'equals', year) // Filter image collection by year
    .map(confMask) // Apply confidence mask >50%
    .reduce(ee.Reducer.countDistinct()) 
 // Reduce image collection by count distinct doy
    .set('year', year) ));// Set composite year as an image property
    .set('system:time_start', ee.Date.fromYMD(year, 1, 1
});
var cntFiresDOY = ee.ImageCollection.fromImages(fireCnt_list); 
// Convert the image List back to an ImageCollection</code><button class="btn" id="copy-button" data-clipboard-target="#target4">Copy</button>
<script>new ClipboardJS('.btn');</script></pre>

<p>Summarise these results to represent the most frequently burnt day-of-year (doy) and the frequency areas have burnt in 
Kruger over the last 18 years (2001-2018).

<pre><p><code class="javascript" id="target5">var modFires = doyFires.mode().clip(knp_geo);
var cntFires = cntFiresDOY.sum().clip(knp_geo);
</code><button class="btn" id="copy-button" data-clipboard-target="#target5">Copy</button>
<script>new ClipboardJS('.btn');</script></p></pre>
<hr>
<p><strong>Charting</strong>
<br>To plot these results, first define your chart parameters (e.g. title and axis labels), then create the line chart, 
incorporating these pre-defined chart parameters and print it to the console as follows:

<pre><p><code class="javascript" id="target6">xxxx</code><button class="btn" id="copy-button" data-clipboard-target="#target6">Copy</button>
<script>new ClipboardJS('.btn');</script></p></pre>

<p><img src="img/5_img3.png" width="650" alt="" title=""/></p>
<p><strong>Figure 2:</strong>Line chart the number of days a fire occured in Kruger from 2001 to 2018</p>
<hr>

<p><strong>Visualisation</strong>
<br>To visualise the long-term summaries of your results, first setup your map elements as you've done in previous practicals.

<pre><p><code class="javascript" id="target7">xxxx</code><button class="btn" id="copy-button" data-clipboard-target="#target7">Copy</button>
<script>new ClipboardJS('.btn');</script></p></pre>
<p><img src="img/5_img4.png" width="650" alt="" title=""/></p>
<p><strong>Figure 3:</strong>Map with layers indicating the most frequently burnt doy-of-year (doy) and the fire frequency in Kruger from 2001 to 2018</p>
<hr>

<p><strong>Hillshade and Animation</strong>
<br>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

<pre><p><code class="javascript" id="target8">xxxx</code><button class="btn" id="copy-button" data-clipboard-target="#target8">Copy</button>
<script>new ClipboardJS('.btn');</script></p></pre>
<p><img src="img/5_img5.gif" width="200" alt="" title=""/></p>
<p><strong>Figure 4:</strong>Animation of days fires occurred in Kruger from 2001 to 2018. 
Light colours represent fires that happened earlier in the year, while dark colours are those that burnt in later months</p>
<hr>

<p><strong>Data Export</strong>
<br>To export the animation, simply right mouse-click and select Save Image As… to save the animation locally as a .GIF file to your hard-drive.
As a last step is always "save your script".

<pre><p><code class="javascript" id="target9">xxxx</code><button class="btn" id="copy-button" data-clipboard-target="#target9">Copy</button>
<script>new ClipboardJS('.btn');</script></p></pre>
<p><img src="img/5_img5.gif" width="200" alt="" title=""/></p>
<p><strong>Figure 4:</strong>Animation of days fires occurred in Kruger from 2001 to 2018. 
Light colours represent fires that happened earlier in the year, while dark colours are those that burnt in later months</p>
<hr>

<p><strong>Practical Assignment #5</strong>
<pre><p><code class="javascript" id="target10">// To complete the practical exercise below share
// your scripts and App URL with us, as described above
// !NB! Remember to add the prac number in the header
// Also see https://biomath-lab.github.io/OTS-GEE/pages/4_prac.html for more help
// -----------------------------------------------------------

// Generate your own App using rainfall or any other climate variable*
// to describe how values differ from one region to the next
// * Don't forget CHIRPS is only available for the Southern Hemisphere
// [HINT: Lines 213 to 288]

// Go crazy! I cant wait to see what you come up with :)</code><button class="btn" id="copy-button" data-clipboard-target="#target10">Copy</button>
<script>new ClipboardJS('.btn');</script></pre>
<hr>
<p>Please share your feedback on this practical by completing this <a href="https://docs.google.com/forms/d/1AShA7pBEcRrUn7a0pA8fEq8qSismI5l2CIOk-Wij-Cw/viewform" target="_blank">quick (2 min) survey.</a> Thank you.</p>
</div>

<div id="sidebar">
<h3>MENU</h3>
<ul>
<li><a href="../index.html">HOME</a></li>
<nav class="drop-down-menu">
<input type="checkbox" class="activate" id="accordion-1" name="accordion-1">
<label for="accordion-1" class="menu-title">> COURSE 2020</label>
<div class="drop-down">
<li><a href="">Check again later</a></li>
</div>
</nav>
<nav class="drop-down-menu">
<input type="checkbox" class="activate" id="accordion-2" name="accordion-2">
<label for="accordion-2" class="menu-title">> COURSE 2021</label>
<div class="drop-down">
<li><a href="1_prac.html">[Prac1] Getting started</a></li>
<li><a href="2_prac.html">[Prac2] Spectral indices</a></li>
<li><a href="3_prac.html">[Prac3] Time series-NDVI</a></li>
<li><a href="4_prac.html">[Prac4] Interactive App</a></li>
<li class="selected"><a href="5_prac.html">[Prac5] Time series-Fire</a></li>
<li><a href="6_prac.html">[Prac6] Change analysis</a></li>
<li><a href="7_prac.html">[Prac7] Landcover class</a></li>
<li><a href="8_prac.html">[Prac8] Species patterns</a></li>
<li><a href="9_prac.html">[Prac9] Your own data</a></li>
</div>
</nav>
<li><a href="10_contact.html">CONTACT US</a></li>
</nav>
</ul>

<h3></h3>
</div>

<div style="clear: both;"> </div>
<ul style="text-align:center; padding: 0px 0px 0px 0px;background: #ffffff;"><img src="img/logo_all.png" align="middle" width="800" height="123" alt="" title=""/></ul>	

<div id="footer">
<p>&copy; Copyright 2021 BioGIS | Designed by <a href="http://www.biogis.co.za" target="_blank">BioGIS</a></p>
</div>

</div>
<!-- 2. Include library -->
<script src="../clipboard.min.js"></script>

<!-- 3. Instantiate clipboard -->
<script>
      var clipboard = new ClipboardJS('.btn');

      clipboard.on('success', function (e) {
        console.log(e);
      });

      clipboard.on('error', function (e) {
        console.log(e);
      });
</script>

</body>
</html>
