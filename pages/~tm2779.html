<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="../scripts/style.css" />
<script src="../scripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="../scripts/clipboard.min.js"></script>
<title>Google Earth Engine for Ecology and Conservation</title>
</head>

<body ccID="357">

<div ccID="367" id="wrap">
<div ccID="384" id="header">
<h1 ccID="403">GOOGLE EARTH ENGINE APPLICATIONS</h1>
<h1 ccID="446">IN ECOLOGY AND CONSERVATION</h1>
</div>

<div ccID="494" id="content">
<h2 ccID="514">GOOGLE EARTH ENGINE FOR ECOLOGY AND CONSERVATION</h2>
<p ccID="573"><strong ccID="576">Practical 4: Building your first App using long-term patterns of rainfall in Ethiopia and Awash National Park</strong>
<br ccID="704">by Sandra MacFadyen @ <a ccID="730" href="https://www0.sun.ac.za/biomath/">https://www0.sun.ac.za/biomath</a>
<br ccID="808">Access the practical script <a ccID="840" href="https://code.earthengine.google.com/a320787ea8a9056e8b4fcba139e012b7">here</a>.
<br ccID="930"><br ccID="934">
<strong ccID="940">Learning Objectives</strong><br ccID="976">
By the end of this practical you should be able to:
<ol ccID="1035"><li ccID="1039">Access long-term rainfall data</li>
<li ccID="1080">Summarise temporal data by regions</li>
<li ccID="1125">Display results on a map and in time-series plots</li>
<li ccID="1185">Make an interactive map (GEE App)</li>
<li ccID="1229">Compare rainfall and vegetation 'greenness" (i.e. rainfall as a driver of ecosystem processes like vegetation dynamics)</li>
<li ccID="1359">Output data (csv, rasterStack) for analysis outside of GEE</li>
</ol>
<p ccID="1435"><img ccID="1438" src="img/4_img1.png" width="650" alt="" title="" />
<hr ccID="1496">

<p ccID="1504"><strong ccID="1507">Introduction</strong>
<br ccID="1538">Rainfall plays a central role in a myriad of natural processes, including river health, the transportation of nutrients, soil moisture, vegetation dynamics,
  fire regimes, animal movement and distribution patterns and landscape heterogeneity.
  Within protected areas these processes function together to safeguard ecosystem integrity. In the face of current climate change predictions,
  the spatio-temporal patterns of rainfall is an increasingly important component to include in any ecological study (<a ccID="2051" href="https://rmets.onlinelibrary.wiley.com/doi/abs/10.1002/joc.5394">MacFadyen et al 2018</a>).
  Here we explore patterns of monthly rainfall across Ethiopia and the Awash National Park from 1981 to 2019 (39 years).
  We'll summarise annual rainfall patterns over different regions using line charts and examine the long-term spatial patterns of rainfall using an interactive map.
  Lastly, we'll take a look at how the temporal patterns of annual rainfall compares to those of vegetation vigour or 'greenness',
  highlighting its importance as a bottom-up ecosystem driver.</p>
<hr ccID="2640">

<p ccID="2648"><strong ccID="2651">Importing datasets</strong>
<br ccID="2688">The datasets we will use for this practical are all available on Google Earth Engine and can be accessed as follows (You can convert these to an import record,
using `convert` from the pop-up message):

<pre ccID="2898"><p ccID="2903"><code ccID="2906" class="javascript" id="target1">var Countries = ee.FeatureCollection('USDOS/LSIB/2017');
var WDPA = ee.FeatureCollection('WCMC/WDPA/current/polygons');
var CHIRPS = ee.ImageCollection('UCSB-CHG/CHIRPS/PENTAD');
var MOD13Q1 = ee.ImageCollection('MODIS/006/MOD13Q1');</code><button ccID="3187" class="btn" id="copy-button" data-clipboard-target="#target1">Copy</button>
<script ccID="3272">new ClipboardJS('.btn');</script></pre>

<p ccID="3323">The first dataset, <a ccID="3345" href="https://developers.google.com/earth-engine/datasets/catalog/WCMC_WDPA_current_polygons" target="_blank">LSIB 2017</a>, contains polygon representations of all international boundaries.
The second, <a ccID="3552" href="https://developers.google.com/earth-engine/datasets/catalog/WCMC_WDPA_current_polygons" target="_blank">WDPA</a>, contains polygons of all the world's protected areas.
The third, <a ccID="3741" href="https://developers.google.com/earth-engine/datasets/catalog/UCSB-CHG_CHIRPS_PENTAD" target="_blank">CHIRPS</a>, is a gridded rainfall time series dataset (Funk et al 2015) and the last,
<a ccID="3937" href="https://developers.google.com/earth-engine/datasets/catalog/MODIS_006_MOD13Q1" target="_blank">MOD13Q1</a>, provides vegetation indexes (NDVI and NDVI) depicting vegetation 'greenness' per 250m pixel.
<hr ccID="4148">

<p ccID="4156"><strong ccID="4159">Filtering data</strong>
<br ccID="4192">First define variables for the temporal window of interest, including a start-date and end-date.
We will use these variables later to filter and summarise these long-term data.

<pre ccID="4377"><p ccID="4382"><code ccID="4385" class="javascript" id="target2">// Setup date range
var startDate = ee.Date.fromYMD(1981,1,1);
var endDate = ee.Date.fromYMD(2019,12,31);
// This we'll use later when comparing rainfall and NDVI
var startDateX = ee.Date.fromYMD(2000,1,1); </code><button ccID="4641" class="btn" id="copy-button" data-clipboard-target="#target2">Copy</button>
<script ccID="4726">new ClipboardJS('.btn');</script></pre>

<p ccID="4777">Then filter our polygon features to our areas of interest (AOI), namely Ethiopia and Awash National Park.

<pre ccID="4889"><p ccID="4894"><code ccID="4897" class="javascript" id="target3">var ethiopia = Countries.filter(ee.Filter.eq('COUNTRY_NA', 'Ethiopia'));
// Returns info about Ethiopia but can take memory, so limit to first 10 records
print('Check Ethiopia Info',ethiopia.limit(10)); 
// Other usefull print function incl.
print('Ethiopia data-type', ethiopia.name()); // Returns object type
print('Ethiopia collection size', ethiopia.size()); // Returns collection size
// Returns variable's properties
print('Ethiopia properties', ethiopia.propertyNames()); 

// WDPA boundaries filtered to 'Awash' National Park in Ethiopia
// Visit https://www.protectedplanet.net to find the correct spelling for names
var awash = WDPA.filter(ee.Filter.eq('ORIG_NAME', 'Awash'));
print('Awash data-type',awash.name());
Map.centerObject(ethiopia, 8);
Map.addLayer(ethiopia, {color: '006600', strokeWidth: 5}, 'Ethiopia', false); 
Map.addLayer(awash,{color: 'grey'}, 'Awash',true, 0.8);  // Add Awash boundary</code><button ccID="5871" class="btn" id="copy-button" data-clipboard-target="#target3">Copy</button>
<script ccID="5956">new ClipboardJS('.btn');</script></pre>

<p ccID="6007">Now filter the CHIRPS ImageCollection for rainfall (i.e. precipitation) and the MODIS MOD13Q1 product for the Normalized Difference Vegetation Index (NDVI) used in the previous practical.
At the same time, filter by date range and clip the collection to your AOI to speed up all analyses that will follow. .

<pre ccID="6322"><p ccID="6327"><code ccID="6330" class="javascript" id="target4">// Lomg-term rainfall from CHIRPS
var rainAll = CHIRPS.select('precipitation')
    .filterDate(startDate, endDate);
print('rainAll Info', rainAll.limit(10));
print('rainAll data-type', rainAll.name());
// Check how many images are in the full imageCollection
print('rainAll collection size ', rainAll.size());
// To deal with memory issues you can cut your dataset to your AOI
// First create a clip function and iterate over each image in the image collection
// ** From BONUS section, Prac #1
var clipF = function(image){
  return image.clip(ethiopia).rename('rain'); 
// We use .rename here just because 'precipitation' is too long :)
};

// Now run it over the CHIRPS images in the collection
var rainClip = rainAll.map(clipF);

// Long-term NDVI data from MODIS
var ndviAll = MOD13Q1.select('NDVI')
    .filterDate(startDateX, endDate);</code><button ccID="7236" class="btn" id="copy-button" data-clipboard-target="#target4">Copy</button>
<script ccID="7321">new ClipboardJS('.btn');</script></pre>
<hr ccID="7370">

<p ccID="7378"><strong ccID="7381">Processing</strong>
<br ccID="7410">To plot the long-term patterns of accumulated monthly rainfall across Awash National Park from 1981 to 2019,
reduce the monthly rainfall records by Awash region as follows:
<pre ccID="7589"><p ccID="7594"><code ccID="7597" class="javascript" id="target5">// Set your chart option parameters 
var opt_chart_mnthRain = {
  title: 'Mean Monthly Rainfall: Awash National Park 1981-2019',
  hAxis: {title: 'Month'},
  vAxis: {title: 'Rainfall (mm)'},
};

// Create your barchart/histogram
var chart_mnthRain = ui.Chart.image.series({
  imageCollection: rainClip,
  region: awash,
  reducer: ee.Reducer.mean(),
  scale: 5000,
  xProperty: 'month' 
}).setChartType('ColumnChart')
.setOptions(opt_chart_mnthRain);
// Use the print() command to display your chart in the code editor console
print(chart_mnthRain);</code><button ccID="8208" class="btn" id="copy-button" data-clipboard-target="#target5">Copy</button>
<script ccID="8293">new ClipboardJS('.btn');</script></p></pre> 

<p ccID="8349"><img ccID="8352" src="img/4_img3a.png" width="550" alt="" title="" />

<p ccID="8413">To generate a line chart of annual rainfall though, we first need to summarise our dataset before trying to plot it. 
This will help us avoid a "memory capacity exceeded" error.

<pre ccID="8598"><p ccID="8603"><code ccID="8606" class="javascript" id="target5b">// To summarise by year, define a list of years 
// to summarise over.
// Get this directly from the ImageCollection itself
var years = ee.List(rainClip.aggregate_array('year')).distinct().sort();
// Or just create a sequence list
// var years = ee.List.sequence(1981, 2019);
print(years);

// Map over the list of years to build a list of annual image composites.
var yearList = years.map(function(year) {
  return rainClip
    // Filter image collection by year.
    .filterMetadata('year', 'equals', year)
    // Reduce image collection by mean.
    .reduce(ee.Reducer.mean())
    // Set composite year as an image property.
    .set('year', year);
	.set('yrString',ee.String(year).slice(0,4)); 
	// This is added to help rename bands later
});
print('Check yearList', yearList.limit(10));
print('yearList size', yearList.size());

// Convert the image List to an ImageCollection.
var rainYears = ee.ImageCollection.fromImages(yearList.flatten());
// print('Check rainYears', rainYears.limit(10));
print('Check rainYears', rainYears.name());

// Now chart your results
// First define the chart options
var opt_chart_annualRain = {
  title: 'Annual Rainfall in Ethiopia from 1981-2019',
  // pointSize: 2, lineWidth: 1,
  hAxis: {title: 'Year'},
  vAxis: {title: 'Rainfall (mm)'},
};

// Then create your line chart
var chart_annualRain = ui.Chart.image.series({
  imageCollection: rainYears,
  region: ethiopia,
  reducer: ee.Reducer.mean(),
  scale: 5000,
  xProperty: 'year'
}).setOptions(opt_chart_annualRain);
// print(chart_annualRain);</code><button ccID="10242" class="btn" id="copy-button" data-clipboard-target="#target5b">Copy</button>
<script ccID="10328">new ClipboardJS('.btn');</script></pre>

<img ccID="10379" src="img/4_img3b.png" width="550" alt="" title="" />

<p ccID="10440">You can also calculate the long-term mean rainfall for the whole of Ethiopia as follows:
<pre ccID="10533"><p ccID="10538"><code ccID="10541" class="javascript" id="target6">// Long-term mean rainfall of Ethiopia
var rainAnnual = rainClip.mean();
// var rainAnnual = rainAll.mean().clip(ethiopia); // Would also work
// print('Check Long-term mean', rainAnnual); // Use print() to check your results</code><button ccID="10814" class="btn" id="copy-button" data-clipboard-target="#target6">Copy</button>
<script ccID="10899">new ClipboardJS('.btn');</script></p></pre>

<br ccID="10954"><hr ccID="10958">
<p ccID="10964"><strong ccID="10967">Visualisation</strong>
<br ccID="10999">Now let's plot these results on a map. First define centre the map to Ethiopia.
Then add Ehtiopia's boundary, the long-term mean annual rainfall for Ethiopia and finally the boundary for Awash National Park.
<pre ccID="11213"><p ccID="11218"><code ccID="11221" class="javascript" id="target7">// Centre your map
Map.centerObject(ethiopia, 4.5);
// Add Ethiopia but make the border quite thick so it looks like only an outline
Map.addLayer(ethiopia, {color: '006600', strokeWidth: 5}, 'Ethiopian Boundary'); 
// Add the mean rainfall and use the legend parameters 
// stored as the import entry, "ltVis" 
Map.addLayer(rainAnnual, ltVis, 'Long-term Annual Rainfall');
// Lastly, add Awash's boundary
Map.addLayer(awash,{color: 'black'}, 'Awash National Park',true, 1);</code><button ccID="11747" class="btn" id="copy-button" data-clipboard-target="#target7">Copy</button>
<script ccID="11832">new ClipboardJS('.btn');</script></p></pre>

<p ccID="11887"><img ccID="11890" src="img/4_img2.png" width="650" alt="" title="" />

<p ccID="11950"><strong ccID="11953">More Charting Options</strong>
<br ccID="11993">We can also summarise these annual rainfall results by different regions i.e. Awash National Park and Ethiopia.
To do this, first create a new featureCollection and then define the chart parameters (e.g. title and axis labels) and plot a line chart
using a secondary y-axis.

<pre ccID="12277"><p ccID="12282"><code ccID="12285" class="javascript" id="target9">// Create a new feature collection with both Ethiopia and Awash boundaries
var myRegions = ee.FeatureCollection([
  //NB! the .geometry() function convert ours features to geometry variables
  ee.Feature(ethiopia.geometry(), {'place': 'Ethiopia'}), 
  ee.Feature(awash.geometry(), {'place': 'Awash'})
]);
print('Check myRegions', myRegions);

// Set your chart options
var opt_chart_regions = {
  title: 'Annual Average Rainfall 1981-2019',
          hAxis: {title: 'Year', format: '####'},
          vAxis: {title: 'Rainfall (mm)'},
          lineWidth: 2,
          colors: ['31159a', '4ecbd4'], // Include 2 colours, 1 for each line
};

// Now define the chart and print it to the console.
var chart_regions =
    ui.Chart.image.seriesByRegion({
          imageCollection: rainYears,
          // band: 'rain_mean',
          regions: myRegions, // This is your new FeatureCollection
          reducer: ee.Reducer.mean(),
          scale: 5000,
          seriesProperty: 'place', // This is your grouping field
          xProperty: 'year' // And the x-axis is your year property
        }).setOptions(opt_chart_regions);
// print(chart_regions);</code><button ccID="13506" class="btn" id="copy-button" data-clipboard-target="#target9">Copy</button>
<script ccID="13591">new ClipboardJS('.btn');</script></pre>

<img ccID="13642" src="img/4_img4.png" width="550" alt="" title="" />

<p ccID="13702">Now instead of using print() to see this chart in the GEE console, we'll instead add it to the map layout.
To do this, first make sure the print() function above is commented out. Then we will start adding the different elements
to our map:
<hr ccID="13949">

<p ccID="13957"><strong ccID="13960">Adding additional elements to your map</strong>
<br ccID="14017">Before making our App we need to add more information to our map, like a title or summary chart.
<pre ccID="14119"><p ccID="14124"><code ccID="14127" class="javascript" id="target10">// Create a map title
var title = ui.Label('Annual Rainfall in Ethiopia from 1981 to 2018', {
  stretch: 'horizontal',
  textAlign: 'center',
  fontWeight: 'bold',
  fontSize: '20px'
});

// Add this title to the map
Map.add(title);

// Create a panel to hold the chart in the map instead of "Console" 
// NB! You must turn off print(chart); above for this to work
var panel = ui.Panel();
panel.style().set({
  width: '350px',
  position: 'bottom-left'
});

// Add this empty chart panel to the map
Map.add(panel);
// Fill the panel with the chart
panel.add(chart_regions);</code><button ccID="14768" class="btn" id="copy-button" data-clipboard-target="#target10">Copy</button>
<script ccID="14854">new ClipboardJS('.btn');</script></pre>
<img ccID="14903" src="img/4_img1.png" width="650" alt="" title="" />
<hr ccID="14961">

<p ccID="14969"><strong ccID="14972">Save your map online</strong>
<br ccID="15011">Now for the fun part! We can share this map with the world by creating a GEE Application (App).
<br ccID="15112">To do this, follow the steps below:
<ol ccID="15153"><li ccID="15157">Click the <code ccID="15171">Apps</code> button above
<li ccID="15203">Select <code ccID="15214">NEW APP</code>
<li ccID="15236">Give the App a Name and click <code ccID="15270">PUBLISH</code>. Leave everything else default
<li ccID="15323">Your new URL will appear - Click this to see your first online interactive map (if you get an error message, follow the steps below instead).
<li ccID="15470">If you see a <code ccID="15487">Not ready</code> page, give it a few minutes and try again</li></ol>
<p ccID="15563"><img ccID="15566" src="img/4_img5a.png" width="650" alt="" title="" /></p>

<p ccID="15631">If you get an error message, chances are you haven't accepted the terms and conditions of using GEE Apps in your Google Cloud Platform.
To do so, follow these steps instead of the ones above.
<ol ccID="15828"><li ccID="15832">Click the Apps button above
<li ccID="15865">Select NEW APP
<li ccID="15885">Give the App a Name and click PUBLISH
<li ccID="15928">When the error appears, click the Cloud Terms of Service link
<li ccID="15995">This will open the Cloud Platform Console (if not open it <a ccID="16057" href="https://console.cloud.google.com/home/dashboard">here</a>)
<li ccID="16126">Go down to App Engine and select Dashboard
<li ccID="16174">You'll be asked to agree to the Terms of Service, AGREE AND CONTINUE
<li ccID="16248">Close your Cloud Platform Console and go back to GEE and click NEW APP again
<li ccID="16330">Give the App a Name and click PUBLISH. Leave everything else default
<li ccID="16404">Your new URL will appear - Click this to see your first online interactive map
<li ccID="16488">If you see a Not ready page, give it a few minutes or refresh the page and try again</li></ol>

<p ccID="16590"><img ccID="16593" src="img/4_img5b.png" width="650" alt="" title=""/></p>

<p ccID="16657"><strong ccID="16660"><a ccID="16668" href="https://biogis.users.earthengine.app/view/rainprac4">And voilà! Your first GEE App!</a></strong></p>
<img ccID="16780" src="img/4_img6.png" width="650" alt="" title="" />
<hr ccID="16838">

<p ccID="16846"><strong ccID="16849">Relationship between annual rainfall and vegetation 'greenness'</strong>
<br ccID="16931">Taking things even further, we could also combine the calculation of annual mean rainfall with annual mean NDVI for Ethiopia
for the same period, 2000 to 2019, to see whether there's a relationship between the two.
What do you think we'll see?

<pre ccID="17184"><p ccID="17189"><code ccID="17192" class="javascript" id="target11">// Clip NDVI to ethiopia and add a 'Year" property to the result
var ndviClip = ndviAll.map(function(img){
    var date = ee.Date(img.get('system:time_start')).format('YYYY');
    return img.set('year',ee.String(ee.Number.parse(date)));
});    
print('Check ndviClip: ', ndviClip);
print('Check ndviClip: ', ndviClip.first().propertyNames());

var yearsX = ee.List(ndviClip.aggregate_array('year')).distinct().sort();
// var yearsX = ee.List.sequence(2000, 2019); // Or just make a sequence
print('Check yearsX',yearsX);</code><button ccID="17768" class="btn" id="copy-button" data-clipboard-target="#target12">Copy</button>
<script ccID="17854">new ClipboardJS('.btn');</script></pre>

<p ccID="17905">Now calculate the annual mean for each year for both Rainfall and NDVI imageCollections.

<pre ccID="18000"><p ccID="18005"><code ccID="18008" class="javascript" id="target13a">// Calculate annual mean for every year for both Rainfall and NDVI imageCollections
var annualRainNDVI_list =  yearsX.map(function(y){
  var rainYear = rainClip.filter(ee.Filter.calendarRange(y,y,'year'))
  	  		   	.mean().rename('rain');
  var ndviYear = ndviClip.filter(ee.Filter.calendarRange(y,y,'year'))
  	  		   	.mean().multiply(0.0001).rename('ndvi'); 
// .multiply(0.0001) scale by constant the constant refered to in the metadata
  return ndviYear.addBands(rainYear).set('year', y);
});
// print('Check annualRainNDVI_list', annualRainNDVI_list);
print('Check annualRainNDVI_list', annualRainNDVI_list.name());

// Convert the image List to an ImageCollection.
var annualRainNDVI = ee.ImageCollection.fromImages(annualRainNDVI_list.flatten());
// print('Check annualRainNDVI', annualRainNDVI);</code><button ccID="18874" class="btn" id="copy-button" data-clipboard-target="#target13a">Copy</button>
<script ccID="18961">new ClipboardJS('.btn');</script></p></pre>

<p ccID="19016">Then create a comparative line chart of both summaries. Remember to first define the chart parameters and then 
create the line chart with two y-axes as follows:
<pre ccID="19183"><p ccID="19188"><code ccID="19191" class="javascript" id="target13b">// Display a comparative line chart of rainfall and NDVI for Ethiopia 
// Set chart parameters e.g. title
var opt_chart_RainNDVI = {
    title: "Annual Max Rainfall vs. 'Greenness (NDVI) for Ethiopia", 
    pointSize: 3,
    legend: {maxLines: 5, position: 'top'},
    series: { 0: {targetAxisIndex: 0, color: 'green', lineWidth: 1, pointSize: 2},
              1: {targetAxisIndex: 1, color: 'blue', lineWidth: 1, pointSize: 2}},
        vAxes: {// Adds titles to each axis.
          0: {title: 'Mean NDVI (*0.0001)'},
          1: {title: 'Mean Rainfall (mm)'}},};
          
// Build the chart and plot it          
var chart_RainNDVI = ui.Chart.image.series({
  imageCollection: annualRainNDVI.select(['ndvi','rain']),
  region: ethiopia,
  reducer: ee.Reducer.mean(),
  scale: 5000,
  xProperty: 'year'
}).setOptions(opt_chart_RainNDVI);
// print(chart_RainNDVI);</code><button ccID="20127" class="btn" id="copy-button" data-clipboard-target="#target13b">Copy</button>
<script ccID="20214">new ClipboardJS('.btn');</script></p></pre>
<hr ccID="20267">

<p ccID="20275"><strong ccID="20278">Correlation between annual rainfall and vegetation 'greenness'</strong>
<br ccID="20359">We could also directly check the correlation between the two variables as follows:
<pre ccID="20447"><p ccID="20452"><code ccID="20455" class="javascript" id="target14">// Compute a Pearson's product-moment correlation coefficient
// and the 2-sided p-value test for correlation = 0.
var opt_correl = {
	title: "Correlation between Rainfall and NDVI for Awash", pointSize: 2,
    legend: {maxLines: 5, position: 'top'},
    series: { 0: {targetAxisIndex: 0},
              1: {targetAxisIndex: 1}},
        vAxes: {// Adds titles to each axis.
          0: {title: 'Correlation - R2)'},
          1: {title: 'P-Value'}},};
// Build the chart and plot it
var correl_chart = ui.Chart.image.series({
  imageCollection: annualRainNDVI.select(['NDVI', 'rain']),
  region:aoi_clip,
  reducer: ee.Reducer.pearsonsCorrelation(),
  scale: 5000,
  xProperty: 'year'
}).setOptions(opt_correl);
print(correl_chart);

// Display a comparative line chart of rainfall and NDVI for Ethiopia 
// Set chart parameters e.g. title
var opt_chart_RainNDVI = {
    title: "Annual Max Rainfall vs. 'Greenness (NDVI) for Ethiopia", 
    pointSize: 3,
    legend: {maxLines: 5, position: 'top'},
    series: { 0: {targetAxisIndex: 0, color: 'green', lineWidth: 1, pointSize: 2},
              1: {targetAxisIndex: 1, color: 'blue', lineWidth: 1, pointSize: 2}},
        vAxes: {// Adds titles to each axis.
          0: {title: 'Mean NDVI (*0.0001)'},
          1: {title: 'Mean Rainfall (mm)'}},};
          
// Build the chart and plot it          
var chart_RainNDVI = ui.Chart.image.series({
  imageCollection: annualRainNDVI.select(['ndvi','rain']),
  region: ethiopia,
  reducer: ee.Reducer.mean(),
  scale: 5000,
  xProperty: 'year'
}).setOptions(opt_chart_RainNDVI);
// print(chart_RainNDVI);</code><button ccID="22146" class="btn" id="copy-button" data-clipboard-target="#target14">Copy</button>
<script ccID="22232">new ClipboardJS('.btn');</script></p></pre>
<img ccID="22285" src="img/4_img8.png" width="500" alt="" title=""/>
<hr ccID="22342">

<p ccID="22350"><strong ccID="22353">Data Export</strong>
<br ccID="22383">To export the data shown in the created charts, you can simply maximise the chart and then click Download to
export to formats .CSV, .SVG or .PNG.

<p ccID="22538"><img ccID="22541" src="img/4_img9.png" width="650" alt="" title="" />

<p ccID="22601">You can also script the export. This option will allow you to customise formats for your exported table.
For example, a formatted date field using a reducer to get the mean rainfall value for Awash for each year.
The exported csv table will then contain a column for both date and mean annual rainfall. Once the task is completed,
you will find this csv file in your google drive.

<pre ccID="22991"><p ccID="22996"><code ccID="22999" class="javascript" id="target15">var csv_annualRain = rainYears.map(function(img){
  var year = img.get('year');
  var mean = img.reduceRegion({
    reducer: ee.Reducer.mean(),
    geometry: awash,
    scale: 5000
  });  
  return ee.Feature(null, {'mean': mean.get('rain_mean'),'year': year});
});
print('Check csv_annualRain', csv_annualRain);

// Export a .csv table of year and mean rainfall
Export.table.toDrive({
  collection: csv_annualRain,
  description: 'annualRain',
  folder: 'GEE4CE',
  fileFormat: 'CSV'
});</code><button ccID="23550" class="btn" id="copy-button" data-clipboard-target="#target15">Copy</button>
<script ccID="23636">new ClipboardJS('.btn');</script></pre>

<p ccID="23687">Or you can create a rasterStack and export that to your GDrive as follows:

<pre ccID="23768"><p ccID="23773"><code ccID="23776" class="javascript" id="target16">// Get the band names from the ImageCollection images
var bandNames = ee.List(rainYears.aggregate_array('yrString'));
print('Check bandNames',bandNames);
// Apply the function toBands() on the image collection 
// to stack all bands into one image
// And .rename() to rename the new "rasterStack" layers
var rainYearsStack = rainYears.toBands().rename(bandNames);

// Export aa cloud-optimized GeoTIFF.
// i.e. rasterStack with 39 layers, representing annual rainfall from 1981 to 2019
Export.image.toDrive({
  image: rainYearsStack,
  folder: 'GEE4CE',
  description: 'Rainfall_Sums',
  scale: 5000,
  region: awash,
  fileFormat: 'GeoTIFF',
  formatOptions: {
    cloudOptimized: true
  }
});</code><button ccID="24536" class="btn" id="copy-button" data-clipboard-target="#target16">Copy</button>
<script ccID="24622">new ClipboardJS('.btn');</script></pre>
<hr ccID="24671">

<p ccID="24679"><strong ccID="24682">Sharing your code to complete the practical assignments</strong>
<br ccID="24756">In the previous practical assignments, you shared your scripts with us using the "Get Link" button below to copy/paste 
your script link into an email to us at <a ccID="24921" href="mailto:ots.online.education@gmail.com">ots.online.education@gmail.com</a>.
your scripts.
<p ccID="25021"><img ccID="25024" src="img/1_img17.png" width="450" alt="" title=""/></p>

<p ccID="25088">In this assignment you will also need to share the URL of your new App with us. Get the URL link by clicking on Apps and then under the
ID (click to update app) get the link directly from the App details page, or just open the App under App Name (click to launch)
and copy/paste the URL into an <a ccID="25388" href="mailto:ots.online.education@gmail.com">email</a> to us. 
<p ccID="25455"><img ccID="25458" src="img/4_img11a.png" width="450" alt="" title=""/></p>
<p ccID="25521"><img ccID="25524" src="img/4_img11b.png" width="450" alt="" title=""/></p>
<hr ccID="25587">

<p ccID="25595"><strong ccID="25598">Practical Assignment #4</strong>
<pre ccID="25640"><p ccID="25645"><code ccID="25648" class="javascript" id="target17">// To complete the practical exercise below share
// your scripts and App URL with us, as described above
// !NB! Remember to add the prac number in the header
// Also see https://biomath-lab.github.io/OTS-GEE/pages/4_prac.html for more help
// -----------------------------------------------------------

// Generate your own App using rainfall or any other climate variable*
// to describe how values differ from one region to the next
// * Don't forget CHIRPS is only available for the Southern Hemisphere
// [HINT: Lines 213 to 288]

// Go crazy! I cant wait to see what you come up with :)</code><button ccID="26299" class="btn" id="copy-button" data-clipboard-target="#target17">Copy</button>
<script ccID="26385">new ClipboardJS('.btn');</script></pre>
<hr ccID="26434">
<p ccID="26440">Please share your feedback on this practical by completing this <a ccID="26507" href="https://docs.google.com/forms/d/1CXibMNcoUTrz2HY2NG2KRefOUphv4DF3f3EiTCbCDL4/viewform" target="_blank">quick (2 min) survey.</a> Thank you.</p>
</div>

<div ccID="26671" id="sidebar">
<h3 ccID="26691">MENU</h3>
<ul ccID="26706">
<li ccID="26712"><a ccID="26716" href="../index.html">HOME</a></li>
<nav ccID="26755" class="drop-down-menu">
<input ccID="26785" type="checkbox" class="activate" id="accordion-1" name="accordion-1">
<label ccID="26863" for="accordion-1" class="menu-title">> COURSE 2020</label>
<div ccID="26930" class="drop-down">
<li ccID="26955"><a ccID="26959" href="">Check again later</a></li>
</div>
</nav>
<nav ccID="27014" class="drop-down-menu">
<input ccID="27044" type="checkbox" class="activate" id="accordion-2" name="accordion-2">
<label ccID="27122" for="accordion-2" class="menu-title">> COURSE 2021</label>
<div ccID="27189" class="drop-down">
<li ccID="27214"><a ccID="27218" href="1_prac.html">[Prac1] Getting started</a></li>
<li ccID="27274"><a ccID="27278" href="2_prac.html">[Prac2] Spectral indices</a></li>
<li ccID="27335"><a ccID="27339" href="3_prac.html">[Prac3] Time series-NDVI</a></li>
<li ccID="27396" class="selected"><a ccID="27417" href="4_prac.html">[Prac4] Interactive App</a></li>
<li ccID="27473"><a ccID="27477" href="5_prac.html">[Prac5] Time series-Fire</a></li>
<li ccID="27534"><a ccID="27538" href="6_prac.html">[Prac6] Change analysis</a></li>
<li ccID="27594"><a ccID="27598" href="7_prac.html">[Prac7] Landcover class</a></li>
<li ccID="27654"><a ccID="27658" href="8_prac.html">[Prac8] Species patterns</a></li>
<li ccID="27715"><a ccID="27719" href="9_prac.html">[Prac9] Your own data</a></li>
</div>
</nav>
<li ccID="27789"><a ccID="27793" href="10_contact.html">CONTACT US</a></li>
</nav>
</ul>

<h3 ccID="27857"></h3>
</div>

<div ccID="27878" style="clear: both;"> </div>
<ul ccID="27913" style="text-align:center; padding: 0px 0px 0px 0px;background: #ffffff;"><img ccID="27990" src="img/logo_all.png" align="middle" width="800" height="123" alt="" title=""/></ul>

<div ccID="28084" id="footer">
<p ccID="28103">&copy; Copyright 2021 BioGIS | Designed by <a ccID="28149" href="http://www.biogis.co.za" target="_blank">BioGIS</a></p>
</div>

</div>
<!-- 2. Include library -->
<script ccID="28262" src="../clipboard.min.js"></script>

<!-- 3. Instantiate clipboard -->
<script ccID="28344">
      var clipboard = new ClipboardJS('.btn');

      clipboard.on('success', function (e) {
        console.log(e);
      });

      clipboard.on('error', function (e) {
        console.log(e);
      });
</script>
</body>
</html>
